(function(e){e.fn.canvasMark=function(t){var n,r,i,s,o,u;var a={frame:0,fps:60,ticks:0,playing:false};var f=function(){if(/(iPad|iPhone|iPod)/g.test(navigator.userAgent)){if(s.width*s.height>=1024*1024){o.width/=2;o.height/=2;s.width/=2;s.height/=2}}var e=[],t=s.width/o.width,n=s.height/o.height;for(var r=0;r<n;r++){for(var i=0;i<t;i++){e.push({y:r*o.height,x:i*o.width})}}return e};var l=function(){window.requestAnimationFrame(l);i.width=n.width();i.height=i.width/(o.width/o.height);if(a.playing){a.ticks++;if(a.ticks>=60/a.fps){a.ticks=0;p()}}var e=i.getContext("2d");e.clearRect(0,0,i.width,i.height);e.drawImage(s,u[a.frame].x,u[a.frame].y,o.width,o.height,0,0,i.width,i.height)};var c=function(){a.playing=true};var h=function(){a.playing=false};var p=function(e,t){if(arguments.length===1){t={frames:e.frames}}else{t=t||{}}v(t.frames||1)};var d=function(e,t){if(arguments.length===1){t={frames:e.frames}}else{t=t||{}}v(t.frames||-1)};var v=function(e,t){var n=0;if(arguments.length===1){n=e}else{n=t.frames}for(var r=0,i=Math.abs(n);r<i;r++){a.frame+=n/Math.abs(n);if(a.frame<=0){a.frame=u.length-1}else if(a.frame>=u.length){a.frame=0}}};this.init=function(t){n=this;i=this[0];o=t.sprite;a.fps=t.fps||a.fps;s=new Image;s.src=t.spriteSheet;e(s).load(function(){u=f();l()});n.on({play:c,pause:h,next:p,prev:d,move:v})};this.init(t);return this}})(jQuery)