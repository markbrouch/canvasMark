(function(e){e.fn.canvasMark=function(t){var n,r,i,s,o,u;var a={frame:0,fps:60,ticks:0,playing:false};var f=function(e){e=e||-1;if(/(iPad|iPhone|iPod)/g.test(navigator.userAgent)){if(s.width*s.height>=2*1024*1024){var t=2;if(s.width*s.height>=20*1024*1024){t=4}o.width/=t;o.height/=t;s.width/=t;s.height/=t}}var n=[],r=s.width/o.width,i=s.height/o.height;for(var u=0;u<i;u++){for(var a=0;a<r;a++){if(n.length<e||e<0){n.push({y:u*o.height,x:a*o.width})}}}return n};var l=function(){window.requestAnimationFrame(l);i.width=n.width();i.height=o.height*(i.width/o.width);if(a.playing){a.ticks++;if(a.ticks>=60/a.fps){a.ticks=0;p()}}var e=i.getContext("2d");e.clearRect(0,0,i.width,i.height);e.drawImage(s,u[a.frame].x,u[a.frame].y,o.width,o.height,0,0,i.width,i.height)};var c=function(){a.playing=true};var h=function(){a.playing=false};var p=function(e,t){if(arguments.length===1){t={frames:e.frames}}else{t=t||{}}v(t.frames||1)};var d=function(e,t){if(arguments.length===1){t={frames:e.frames}}else{t=t||{}}v(t.frames||-1)};var v=function(e,t){var n=0;if(arguments.length===1){n=e}else{n=t.frames}for(var r=0,i=Math.abs(n);r<i;r++){a.frame+=n/Math.abs(n);if(a.frame<=0){a.frame=u.length-1}else if(a.frame>=u.length){a.frame=0}}};var m=function(e,t){var n=0;if(arguments.length===1){n=e}else{n=t.frame}a.frame=n};this.init=function(t){n=this;i=this[0];o=t.sprite;a.fps=t.fps||a.fps;s=new Image;s.src=t.spriteSheet;e(s).load(function(){u=f(t.frames);l()});n.on({play:c,pause:h,next:p,prev:d,move:v,moveTo:m})};this.init(t);return this}})(jQuery)